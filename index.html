<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Monito Bailando 3D con AR</title>
    <script src="https://aframe.io/releases/1.4.0/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/AR-js-org/AR.js/aframe/build/aframe-ar.js"></script>
    <style>
      body {
        margin: 0;
        overflow: hidden;
        font-family: Arial, sans-serif;
      }
      #instructions {
        position: absolute;
        top: 10px;
        left: 10px;
        background: rgba(0,0,0,0.7);
        color: white;
        padding: 10px;
        border-radius: 5px;
        z-index: 1000;
        font-size: 14px;
      }
      #status {
        margin-top: 8px;
        font-size: 12px;
        color: #ffcc00;
      }
    </style>
  </head>
  <body>
    <div id="instructions">
      <p>Apunta la c치mara a un marcador AR para ver al monito bailando</p>
      <button id="musicToggle">Activar M칰sica</button>
      <div id="status">Haz clic en cualquier parte primero</div>
    </div>

    <a-scene
      embedded
      arjs="trackingMethod: best; sourceType: webcam; debugUIEnabled: false;"
    >
      <!-- Marcador Hiro -->
      <a-marker preset="hiro">
        <!-- Monito bailando 3D -->
        <a-entity id="dancing-monkey" position="0 0 0">
          <!-- Cabeza -->
          <a-sphere 
            position="0 2.5 0" 
            radius="0.5" 
            color="#8B4513"
            animation="property: rotation; to: 0 360 0; loop: true; dur: 2000">
          </a-sphere>
          
          <!-- Ojos -->
          <a-sphere position="-0.15 2.6 0.4" radius="0.05" color="white"></a-sphere>
          <a-sphere position="0.15 2.6 0.4" radius="0.05" color="white"></a-sphere>
          <a-sphere position="-0.15 2.6 0.45" radius="0.02" color="black"></a-sphere>
          <a-sphere position="0.15 2.6 0.45" radius="0.02" color="black"></a-sphere>
          
          <!-- Boca -->
          <a-cylinder position="0 2.4 0.4" radius="0.1" height="0.05" color="black"></a-cylinder>
          
          <!-- Cuerpo -->
          <a-cylinder 
            position="0 1.5 0" 
            radius="0.4" 
            height="1" 
            color="#A0522D"
            animation="property: rotation; to: 10 0 -10; loop: true; dir: alternate; dur: 500">
          </a-cylinder>
          
          <!-- Brazos -->
          <a-cylinder 
            position="-0.7 2 0" 
            radius="0.08" 
            height="0.8" 
            rotation="0 0 45"
            color="#8B4513"
            animation="property: rotation; to: 0 0 120; loop: true; dir: alternate; dur: 400">
          </a-cylinder>
          
          <a-cylinder 
            position="0.7 2 0" 
            radius="0.08" 
            height="0.8" 
            rotation="0 0 -45"
            color="#8B4513"
            animation="property: rotation; to: 0 0 -120; loop: true; dir: alternate; dur: 400">
          </a-cylinder>
          
          <!-- Piernas -->
          <a-cylinder 
            position="-0.25 0.5 0" 
            radius="0.1" 
            height="1" 
            color="#8B4513"
            animation="property: rotation; to: 45 0 0; loop: true; dir: alternate; dur: 300">
          </a-cylinder>
          
          <a-cylinder 
            position="0.25 0.5 0" 
            radius="0.1" 
            height="1" 
            color="#8B4513"
            animation="property: rotation; to: -45 0 0; loop: true; dir: alternate; dur: 300">
          </a-cylinder>
          
          <!-- Sombrero de fiesta -->
          <a-cone 
            position="0 3.1 0" 
            radius-bottom="0.4" 
            radius-top="0.1" 
            height="0.3" 
            color="red"
            animation="property: rotation; to: 0 360 0; loop: true; dur: 1500">
          </a-cone>
        </a-entity>
      </a-marker>

      <!-- C치mara -->
      <a-entity camera></a-entity>
    </a-scene>
    
    <!-- Audio para la m칰sica -->
    <audio id="music" loop preload="auto">
      <source src="https://assets.mixkit.co/music/preview/mixkit-game-show-suspense-waiting-667.mp3" type="audio/mpeg">
    </audio>

    <script>
      document.addEventListener('DOMContentLoaded', function() {
        const musicToggle = document.getElementById('musicToggle');
        const music = document.getElementById('music');
        const status = document.getElementById('status');
        let musicEnabled = false;
        
        // Habilitar m칰sica despu칠s de la interacci칩n del usuario
        function enableMusic() {
          musicEnabled = true;
          status.textContent = 'M칰sica lista. Haz clic en "Activar M칰sica"';
          musicToggle.disabled = false;
          
          // Precargar la m칰sica
          music.load();
        }
        
        // Los navegadores requieren interacci칩n del usuario primero
        document.addEventListener('click', enableMusic, { once: true });
        document.addEventListener('touchstart', enableMusic, { once: true });
        
        musicToggle.addEventListener('click', function() {
          if (!musicEnabled) {
            status.textContent = 'Haz clic primero en cualquier parte de la pantalla';
            return;
          }
          
          if (music.paused) {
            // Intentar reproducir la m칰sica
            const playPromise = music.play();
            
            if (playPromise !== undefined) {
              playPromise.then(function() {
                // 칄xito: la m칰sica se est치 reproduciendo
                musicToggle.textContent = 'Desactivar M칰sica';
                status.textContent = 'M칰sica reproduci칠ndose 游꿧';
              }).catch(function(error) {
                // Error: no se pudo reproducir
                console.error('Error:', error);
                status.textContent = 'Error al reproducir. Verifica el volumen.';
              });
            }
          } else {
            // Pausar la m칰sica
            music.pause();
            music.currentTime = 0; // Reiniciar al principio
            musicToggle.textContent = 'Activar M칰sica';
            status.textContent = 'M칰sica pausada';
          }
        });
        
        // Efectos de part칤culas
        const marker = document.querySelector('a-marker');
        
        marker.addEventListener('markerFound', function() {
          // Crear part칤culas de confeti
          for (let i = 0; i < 20; i++) {
            const confetti = document.createElement('a-sphere');
            confetti.setAttribute('position', 
              `${Math.random() * 2 - 1} ${Math.random() * 2 + 1} ${Math.random() * 2 - 1}`);
            confetti.setAttribute('radius', '0.05');
            confetti.setAttribute('color', `hsl(${Math.random() * 360}, 100%, 50%)`);
            confetti.setAttribute('animation', 
              `property: position; to: ${Math.random() * 4 - 2} -2 ${Math.random() * 4 - 2}; dur: 2000`);
            confetti.setAttribute('animation__scale', 
              'property: scale; to: 0 0 0; dur: 2000');
            
            marker.appendChild(confetti);
          }
          
          // Reproducir m칰sica autom치ticamente si est치 habilitada
          if (musicEnabled && music.paused) {
            music.play().catch(function(error) {
              console.log('Reproducci칩n autom치tica bloqueada');
            });
          }
        });
        
        // Limpiar confeti cuando se pierde el marcador
        marker.addEventListener('markerLost', function() {
          const confettiElements = marker.querySelectorAll('a-sphere');
          confettiElements.forEach(function(confetti) {
            // Eliminar solo las part칤culas de confeti, no los elementos del monito
            if (!confetti.parentElement.querySelector('#dancing-monkey')) {
              marker.removeChild(confetti);
            }
          });
        });
      });
    </script>
  </body>
</html>